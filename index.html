<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eternal Hunt Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 { color: #ff4444; margin: 10px 0; }
    .panel { display: none; padding: 20px; }
    .panel.active { display: block; }
    .nav { display: flex; justify-content: center; background: #222; padding: 10px; }
    .nav button {
      margin: 0 5px; padding: 10px 15px;
      border-radius: 8px; border: none; cursor: pointer;
      background: #333; color: #eee;
    }
    .nav button.active { background: #ff4444; }
    .quest.completed { text-decoration: line-through; color: #888; }
    .event-active { animation: glow 1s infinite alternate; }
    @keyframes glow { from { text-shadow: 0 0 5px #f00; } to { text-shadow: 0 0 20px #f00; } }
    .rewarded-ad { margin-top: 20px; border: 2px dashed #444; padding: 15px; border-radius: 10px; }
  </style>
</head>
<body>
  <h1>üê∫ Eternal Hunt</h1>

  <!-- Navigation -->
  <div class="nav">
    <button onclick="openPanel('profile')" class="active">Profile</button>
    <button onclick="openPanel('play')">Play</button>
    <button onclick="openPanel('quests')">Quests</button>
    <button onclick="openPanel('inventory')">Inventory</button>
    <button onclick="openPanel('shop')">Relic Shop</button>
    <button onclick="openPanel('codex')">Codex</button>
    <button onclick="openPanel('leaderboard')">Leaderboard</button>
  </div>

  <!-- Profile Panel -->
  <div id="profile" class="panel active">
    <h2>Profile Settings</h2>
    <input id="usernameInput" placeholder="Enter Discord Username" />
    <br/><br/>
    <select id="roleSelect">
      <option value="wolf">üê∫ Wolf</option>
      <option value="hunter">üèπ Hunter</option>
    </select>
    <br/><br/>
    <button onclick="saveProfile()">Save Profile</button>
    <p id="profileStatus"></p>
  </div>

  <!-- Play Panel -->
  <div id="play" class="panel">
    <h2>Play</h2>
    <button onclick="hunt()">Hunt Prey</button>
    <button onclick="train()">Train (+Strength)</button>
    <button onclick="pvp()">Quick PvP</button>
    <p id="gameResult"></p>
    <p id="bloodMoon"></p>

    <!-- Rewarded Ad Placeholder -->
    <div class="rewarded-ad">
      <p>üé• Watch an ad to earn bonus $PREY!</p>
      <button onclick="watchAd()">Watch Ad</button>
      <p id="adResult"></p>
    </div>
  </div>

  <!-- Quests Panel -->
  <div id="quests" class="panel">
    <h2>Quests</h2>
    <ul id="questList"></ul>
  </div>

  <!-- Inventory Panel -->
  <div id="inventory" class="panel">
    <h2>Inventory</h2>
    <ul id="inventoryList"></ul>
  </div>

  <!-- Shop Panel -->
  <div id="shop" class="panel">
    <h2>Relic Shop</h2>
    <button onclick="buyItem('Potion',20)">Potion (20 $PREY)</button>
    <button onclick="buyItem('Relic Shard',100)">Relic Shard (100 $PREY)</button>
    <button onclick="buyItem('Wolf Totem',200)">Wolf Totem (200 $PREY)</button>
    <p id="shopResult"></p>
  </div>

  <!-- Codex Panel -->
  <div id="codex" class="panel">
    <h2>Lore Codex</h2>
    <div id="codexEntries"></div>
  </div>

  <!-- Leaderboard Panel -->
  <div id="leaderboard" class="panel">
    <h2>Leaderboard</h2>
    <ol id="leaderboardList"></ol>
  </div>

  <!-- Sound Effects -->
  <audio id="huntSound" src="https://actions.google.com/sounds/v1/animals/wolf_howl.ogg"></audio>
  <audio id="trainSound" src="https://actions.google.com/sounds/v1/human_activities/weights_lift.ogg"></audio>
  <audio id="pvpSound" src="https://actions.google.com/sounds/v1/impacts/metal_clang.ogg"></audio>

  <!-- Firebase Setup -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ‚úÖ New Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBz11XDhnqNwMyNUjqFpoC8lppEgCP-mew",
      authDomain: "eternal-hunt-game-e48fb.firebaseapp.com",
      projectId: "eternal-hunt-game-e48fb",
      storageBucket: "eternal-hunt-game-e48fb.firebasestorage.app",
      messagingSenderId: "87971567607",
      appId: "1:87971567607:web:2b4401b8e8672436ea80f2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Game State
    let prey=0,strength=1,level=1,xp=0;
    let role="wolf",username="Unknown";
    let inventory=[];
    let codex={
      wolf:[
        {level:1,text:"The pack awakens under the crimson moon."},
        {level:5,text:"Wolves hunt together, bound by blood."},
        {level:10,text:"Legends say the Eternal Alpha shall rise."}
      ],
      hunter:[
        {level:1,text:"Hunters begin their pursuit of the wolves."},
        {level:5,text:"Steel and courage sharpen under starlight."},
        {level:10,text:"The Eternal Hunt tests every hunter‚Äôs soul."}
      ]
    };

    function openPanel(panel){
      document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
      document.getElementById(panel).classList.add('active');
      document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.nav button[onclick="openPanel('${panel}')"]`).classList.add('active');
      if(panel==='quests') renderQuests();
      if(panel==='inventory') renderInventory();
      if(panel==='codex') renderCodex();
      if(panel==='leaderboard') renderLeaderboard();
    }

    async function saveProfile(){
      username=document.getElementById('usernameInput').value||"Unknown";
      role=document.getElementById('roleSelect').value;
      await setDoc(doc(db,"players",username),{prey,strength,level,xp,role,inventory});
      document.getElementById('profileStatus').textContent="‚úÖ Profile saved!";
    }

    async function hunt(){
      document.getElementById('huntSound').play();
      let gained=Math.floor(Math.random()*10)+1;
      if(isBloodMoon()){ gained*=2; document.getElementById('bloodMoon').textContent="üåë Blood Moon! Double rewards."; }
      else document.getElementById('bloodMoon').textContent="";
      prey+=gained; xp+=10; checkLevelUp();
      document.getElementById('gameResult').textContent=`You hunted and gained ${gained} $PREY. Total: ${prey}`;
      await updatePlayer();
    }

    async function train(){
      if(prey>=20){ document.getElementById('trainSound').play();
        prey-=20; strength++; xp+=5; checkLevelUp();
        document.getElementById('gameResult').textContent=`You trained. Strength=${strength}`;
        await updatePlayer();
      } else document.getElementById('gameResult').textContent="Not enough $PREY to train.";
    }

    async function pvp(){
      document.getElementById('pvpSound').play();
      let enemyStr=Math.floor(Math.random()*5)+1;
      if(strength>=enemyStr){ prey+=15; document.getElementById('gameResult').textContent=`You won! Enemy STR ${enemyStr}.`; }
      else document.getElementById('gameResult').textContent=`You lost. Enemy STR ${enemyStr}.`;
      await updatePlayer();
    }

    function isBloodMoon(){ return Math.floor(Date.now()/60000)%4===0; }
    function checkLevelUp(){ while(xp>=level*100){ xp-=level*100; level++; } }

    function buyItem(item,cost){
      if(prey>=cost){ prey-=cost; inventory.push(item); document.getElementById('shopResult').textContent=`Bought ${item}`; }
      else document.getElementById('shopResult').textContent="Not enough $PREY.";
      updatePlayer();
    }
    function renderInventory(){
      const list=document.getElementById('inventoryList');
      list.innerHTML=""; inventory.forEach(i=>{ let li=document.createElement('li'); li.textContent=i; list.appendChild(li); });
    }

    function renderQuests(){
      const list=document.getElementById('questList'); list.innerHTML="";
      let roleQuests=(role==="wolf")?
        ["Hunt 3 times","Train 2 times","Howl at Blood Moon","Defeat 2 Hunters","Collect a Wolf Totem","Win 3 PvP","Earn 200 $PREY","Level up once","Gather relics","Alpha challenge"]:
        ["Defeat 2 Wolves","Train 3 times","Win 2 PvP","Earn 150 $PREY","Find Relic Shard","Craft Hunter Bow","Complete 5 Hunts","Level up twice","Join Hunter Lodge","Blood Moon Challenge"];
      roleQuests.forEach(q=>{ let li=document.createElement('li'); li.textContent=q; list.appendChild(li); });
    }

    function renderCodex(){
      const div=document.getElementById('codexEntries'); div.innerHTML="";
      codex[role].forEach(c=>{ if(level>=c.level){ let p=document.createElement('p'); p.textContent=c.text; div.appendChild(p);} });
    }

    async function renderLeaderboard(){
      const list=document.getElementById('leaderboardList'); list.innerHTML="";
      const snapshot=await getDocs(collection(db,"players"));
      snapshot.forEach(docSnap=>{
        let p=docSnap.data();
        let li=document.createElement('li'); li.textContent=`${docSnap.id}: ${p.prey} $PREY (L${p.level} STR${p.strength})`; 
        list.appendChild(li);
      });
    }

    function watchAd(){
      let bonus=Math.floor(Math.random()*20)+10;
      prey+=bonus;
      document.getElementById('adResult').textContent=`You earned ${bonus} $PREY from watching an ad!`;
      updatePlayer();
    }

    async function updatePlayer(){
      if(!username) return;
      await setDoc(doc(db,"players",username),{prey,strength,level,xp,role,inventory});
    }
  </script>
</body>
</html>
