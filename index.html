<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eternal Hunt Game</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; padding:0; text-align:center; }
h1 { color:#ff4444; font-size:1.8rem; margin-top:10px; }
.tab-buttons { display:flex; flex-wrap:wrap; justify-content:center; padding:5px; }
.tab-buttons button { flex:1 1 45%; margin:5px; padding:10px; border-radius:8px; border:none; background:#333; color:#eee; cursor:pointer; font-size:0.9rem; transition:0.3s; }
.tab-buttons button:hover { background:#ff4444; }
.tab-buttons button.active { background:#ff4444; }
.tab { display:none; padding:10px; }
.tab.active { display:block; }
.quest.completed { text-decoration:line-through; color:#aaa; }
.rewardAnim { animation: rewardFlash 0.8s ease; }
@keyframes rewardFlash { 0% { color:#ff0; transform:scale(1); } 50% { color:#0f0; transform:scale(1.3); } 100% { color:#ff0; transform:scale(1); } }
@media (max-width:500px) { h1{font-size:1.5rem;} .tab-buttons button{flex:1 1 100%; font-size:0.85rem;} .tab{padding:5px; font-size:0.9rem;} }
</style>
</head>
<body>
<h1>üê∫ Eternal Hunt</h1>

<!-- Profile Setup -->
<div id="profilePanel" class="tab active">
  <h2>Player Profile</h2>
  <input type="text" id="playerName" placeholder="Enter Discord username"/>
  <select id="roleSelect">
    <option value="wolf">Wolf</option>
    <option value="hunter">Hunter</option>
  </select>
  <button onclick="setProfile()">Save Profile</button>
  <p id="profileMsg"></p>
</div>

<!-- Player Stats Panel -->
<div id="playerStats" style="display:none;">
  <h3>Player Stats</h3>
  <p id="statsDisplay">Username: - | Role: - | Level: - | Strength: - | $PREY: - | XP: -</p>
</div>

<!-- Tabs -->
<div class="tab-buttons">
  <button onclick="openTab('play')">Play</button>
  <button onclick="openTab('quests')">Quests</button>
  <button onclick="openTab('inventory')">Inventory / Shop</button>
  <button onclick="openTab('codex')">Codex</button>
  <button onclick="openTab('leaderboard')">Leaderboard</button>
  <button onclick="watchAd()">Watch Ad ($PREY)</button>
</div>
<!-- Play Tab -->
<div id="play" class="tab">
  <h2>Hunt / Train / PvP</h2>
  <button onclick="hunt()">Hunt Prey</button>
  <p id="huntResult"></p>
  <p id="bloodMoon"></p>
  <button onclick="train()">Train (+Strength)</button>
  <p id="trainResult"></p>
  <button onclick="pvp()">PvP Quick Match</button>
  <p id="pvpResult"></p>
</div>

<!-- Quests Tab -->
<div id="quests" class="tab">
  <h2>Quests</h2>
  <ul id="questList"></ul>
</div>

<!-- Inventory & Shop Tab -->
<div id="inventory" class="tab">
  <h2>Inventory</h2>
  <ul id="inventoryList"></ul>
  <h3>Shop</h3>
  <button onclick="buyItem('Potion',20)">Potion (20 $PREY)</button>
  <button onclick="buyItem('Relic Shard',100)">Relic Shard (100 $PREY)</button>
  <button onclick="buyItem('Wolf Totem',200)">Wolf Totem (200 $PREY)</button>
  <p id="shopResult"></p>
</div>

<!-- Codex Tab -->
<div id="codex" class="tab">
  <h2>Lore Codex</h2>
  <div id="codexEntries"></div>
</div>

<!-- Leaderboard Tab -->
<div id="leaderboard" class="tab">
  <h2>Leaderboard</h2>
  <ol id="leaderboardList"></ol>
</div>
<script>
// --- Game Variables ---
let playerName = "";
let role = "wolf";
let prey = 0;
let strength = 1;
let level = 1;
let xp = 0;
let inventory = [];
let quests = [];
let codex = [];

// --- Role-based Quests ---
const wolfQuests = [
  {text:"Hunt 3 times", goal:3, progress:0, reward:50, completed:false},
  {text:"Collect 5 Relics", goal:5, progress:0, reward:"Relic Shard", completed:false},
  {text:"Win 2 PvP battles", goal:2, progress:0, reward:100, completed:false},
  {text:"Train 5 times", goal:5, progress:0, reward:20, completed:false},
  {text:"Participate in Blood Moon hunt", goal:1, progress:0, reward:50, completed:false},
  {text:"Hunt rare prey 2 times", goal:2, progress:0, reward:75, completed:false},
  {text:"Equip 3 Relics", goal:3, progress:0, reward:"Wolf Totem", completed:false},
  {text:"Reach level 5", goal:5, progress:0, reward:100, completed:false},
  {text:"Win PvP 5 times", goal:5, progress:0, reward:"Relic Shard", completed:false},
  {text:"Hunt during Blood Moon 3 times", goal:3, progress:0, reward:150, completed:false}
];

const hunterQuests = [
  {text:"Train 3 times", goal:3, progress:0, reward:50, completed:false},
  {text:"Hunt 2 Wolves", goal:2, progress:0, reward:"Relic Shard", completed:false},
  {text:"Win 2 PvP battles", goal:2, progress:0, reward:100, completed:false},
  {text:"Equip 2 Relics", goal:2, progress:0, reward:"Wolf Totem", completed:false},
  {text:"Reach level 4", goal:4, progress:0, reward:50, completed:false},
  {text:"Complete 3 hunts", goal:3, progress:0, reward:30, completed:false},
  {text:"Participate in Blood Moon defense", goal:1, progress:0, reward:75, completed:false},
  {text:"Win PvP 5 times", goal:5, progress:0, reward:150, completed:false},
  {text:"Train 10 times", goal:10, progress:0, reward:200, completed:false},
  {text:"Complete 5 quests", goal:5, progress:0, reward:100, completed:false}
];

// --- Codex Entries ---
const wolfCodex = [
  "Wolves roam the eternal forests, guided by the Blood Moon.",
  "The pack grows stronger with each hunt under the moonlight."
];

const hunterCodex = [
  "Hunters sharpen their skills to face the eternal hunt.",
  "Ancient powers awaken in the heart of the hunter."
];

// --- Profile Setup ---
function setProfile() {
  const nameInput = document.getElementById("playerName").value.trim();
  const selectedRole = document.getElementById("roleSelect").value;

  if (!nameInput) {
    document.getElementById("profileMsg").textContent = "Enter a username";
    return;
  }

  playerName = nameInput;
  role = selectedRole;
  quests = role === "wolf" ? JSON.parse(JSON.stringify(wolfQuests)) : JSON.parse(JSON.stringify(hunterQuests));
  codex = role === "wolf" ? wolfCodex : hunterCodex;

  document.getElementById("profileMsg").textContent = `Profile saved! Username: ${playerName}, Role: ${role}`;
  document.getElementById("profilePanel").style.display = "none";
  document.getElementById("playerStats").style.display = "block";

  updateStats();
  openTab("play");
}

// --- Update Stats Display ---
function updateStats() {
  document.getElementById("statsDisplay").textContent =
    `Username: ${playerName} | Role: ${role} | Level: ${level} | Strength: ${strength} | $PREY: ${prey} | XP: ${xp}`;
}

// --- Open Tab Function ---
function openTab(tabName) {
  document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
  document.getElementById(tabName).classList.add("active");

  document.querySelectorAll(".tab-buttons button").forEach(btn => btn.classList.remove("active"));
  const activeBtn = Array.from(document.querySelectorAll(".tab-buttons button"))
    .find(b => b.textContent.toLowerCase() === tabName);
  if (activeBtn) activeBtn.classList.add("active");

  if (tabName === "quests") renderQuests();
  if (tabName === "inventory") renderInventory();
  if (tabName === "codex") renderCodex();
  if (tabName === "leaderboard") renderLeaderboard();
}

// --- Reward Animation ---
function addRewardAnimation(elementId) {
  const el = document.getElementById(elementId);
  if (!el) return;
  el.classList.add("rewardAnim");
  setTimeout(() => el.classList.remove("rewardAnim"), 800);
}

// --- Level Up Check ---
function checkLevelUp() {
  while (xp >= level * 100) {
    xp -= level * 100;
    level++;
    addRewardAnimation("statsDisplay");
  }
}

// --- Blood Moon Event ---
function isBloodMoon() {
  const now = Date.now();
  // Every 4 minutes for demo
  return Math.floor(now / 60000) % 4 === 0;
}
</script>
<script>
// --- Hunt Function ---
function hunt() {
  if (!playerName) { alert("Set your profile first!"); return; }

  let gained = Math.floor(Math.random() * 10) + 1;
  if (isBloodMoon()) {
    gained *= 2;
    document.getElementById("bloodMoon").textContent = "üåë Blood Moon! Double $PREY!";
  } else {
    document.getElementById("bloodMoon").textContent = "";
  }
  prey += gained;
  xp += 10;
  checkLevelUp();
  document.getElementById("huntResult").textContent = `You hunted and gained ${gained} $PREY.`;
  addRewardAnimation("huntResult");

  updateQuests("hunt");
  updateStatsAndFirestore();
}

// --- Train Function ---
function train() {
  if (!playerName) { alert("Set your profile first!"); return; }
  if (prey >= 20) {
    prey -= 20;
    strength++;
    xp += 5;
    checkLevelUp();
    document.getElementById("trainResult").textContent = `You trained. Strength: ${strength}`;
    addRewardAnimation("trainResult");
  } else {
    document.getElementById("trainResult").textContent = "Not enough $PREY to train.";
  }
  updateQuests("train");
  updateStatsAndFirestore();
}

// --- PvP Function ---
function pvp() {
  if (!playerName) { alert("Set your profile first!"); return; }
  const enemyStr = Math.floor(Math.random() * 5) + 1;
  let result;
  if (strength >= enemyStr) {
    result = "You won!";
    prey += 15;
  } else {
    result = "You lost.";
  }
  document.getElementById("pvpResult").textContent = `Enemy STR: ${enemyStr}. ${result}`;
  addRewardAnimation("pvpResult");
  updateQuests("pvp");
  updateStatsAndFirestore();
}

// --- Buy Item / Shop Function ---
function buyItem(item, cost) {
  if (prey >= cost) {
    prey -= cost;
    inventory.push(item);
    document.getElementById("shopResult").textContent = `Bought ${item}!`;
    addRewardAnimation("shopResult");
  } else {
    document.getElementById("shopResult").textContent = "Not enough $PREY.";
  }
  updateStatsAndFirestore();
  renderInventory();
}

// --- Render Inventory ---
function renderInventory() {
  const list = document.getElementById("inventoryList");
  list.innerHTML = "";
  inventory.forEach(i => {
    const li = document.createElement("li");
    li.textContent = i;
    list.appendChild(li);
  });
}

// --- Render Quests ---
function renderQuests() {
  const list = document.getElementById("questList");
  list.innerHTML = "";
  quests.forEach(q => {
    const li = document.createElement("li");
    li.textContent = `${q.text} [${q.progress}/${q.goal}] Reward: ${q.reward}`;
    if (q.completed) li.classList.add("quest", "completed");
    list.appendChild(li);
  });
}

// --- Update Quests ---
function updateQuests(type) {
  quests.forEach(q => {
    if (!q.completed) {
      if (type === "hunt" && q.text.toLowerCase().includes("hunt")) q.progress++;
      if (type === "train" && q.text.toLowerCase().includes("train")) q.progress++;
      if (type === "pvp" && q.text.toLowerCase().includes("pvp")) q.progress++;
      if (q.progress >= q.goal) {
        q.completed = true;
        if (typeof q.reward === "number") prey += q.reward;
        else inventory.push(q.reward);
      }
    }
  });
  renderQuests();
}

// --- Render Codex ---
function renderCodex() {
  const div = document.getElementById("codexEntries");
  div.innerHTML = "";
  codex.forEach(c => {
    const p = document.createElement("p");
    p.textContent = c;
    div.appendChild(p);
  });
}

// --- Ad Reward Placeholder ---
function watchAd() {
  if (!playerName) { alert("Set your profile first!"); return; }
  // Placeholder: simulate ad watch
  const reward = 25;
  prey += reward;
  document.getElementById("huntResult").textContent = `You watched an ad and earned ${reward} $PREY!`;
  addRewardAnimation("huntResult");
  updateStatsAndFirestore();
}

// --- Firebase Save Player Stats ---
function updateStatsAndFirestore() {
  updateStats();
  if (!playerName) return;
  db.collection("players").doc(playerName).set({
    role, prey, strength, level, xp, inventory, quests
  }).catch(e => console.error("Error saving player:", e));
}

// --- Render Leaderboard ---
function renderLeaderboard() {
  const list = document.getElementById("leaderboardList");
  list.innerHTML = "";
  db.collection("players").get().then(snapshot => {
    const players = [];
    snapshot.forEach(doc => players.push({ name: doc.id, ...doc.data() }));
    players.sort((a,b)=>b.prey - a.prey);
    players.slice(0,10).forEach(p => {
      const li = document.createElement("li");
      li.textContent = `${p.name} | Role: ${p.role} | Level: ${p.level} | STR: ${p.strength} | $PREY: ${p.prey}`;
      list.appendChild(li);
    });
  }).catch(e => console.error("Error fetching leaderboard:", e));
}

// --- Blood Moon Visual Blink ---
setInterval(() => {
  const bm = document.getElementById("bloodMoon");
  if (isBloodMoon() && document.getElementById("play").classList.contains("active")) {
    bm.style.color = "#ff0000";
  } else {
    bm.style.color = "#eee";
  }
}, 1000);
</script>
