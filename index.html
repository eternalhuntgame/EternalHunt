<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üê∫ Eternal Hunt</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; padding:0; text-align:center; }
    h1 { color:#ff4444; margin:10px 0; }
    .container { max-width:480px; margin:auto; padding:10px; }
    .panel { display:none; padding:15px; }
    .panel.active { display:block; animation:fadeIn 0.5s ease; }
    button { background:#333; color:#eee; border:none; padding:10px 15px; margin:5px; border-radius:8px; cursor:pointer; }
    button:hover { background:#444; }
    .tab-buttons { display:flex; flex-wrap:wrap; justify-content:center; }
    .tab-buttons button.active { background:#ff4444; }
    .quest.completed { text-decoration:line-through; color:#888; }
    .event-active { animation:glow 1s infinite alternate; }
    @keyframes glow { from{ text-shadow:0 0 5px #f00; } to{ text-shadow:0 0 15px #f00; } }
    @keyframes fadeIn { from{ opacity:0; } to{ opacity:1; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>üê∫ Eternal Hunt</h1>

    <!-- Profile Setup -->
    <div id="profilePanel" class="panel active">
      <h2>Setup Profile</h2>
      <input id="usernameInput" placeholder="Enter username"/><br/>
      <select id="roleInput">
        <option value="wolf">üê∫ Wolf</option>
        <option value="hunter">üèπ Hunter</option>
      </select><br/>
      <button onclick="saveProfile()">Confirm</button>
    </div>

    <!-- Main Game -->
    <div id="gamePanel" class="panel">
      <div id="profileBar">
        <p id="profileInfo"></p>
      </div>

      <div class="tab-buttons">
        <button onclick="openTab('hunt')" class="active">Hunt</button>
        <button onclick="openTab('train')">Train</button>
        <button onclick="openTab('pvp')">PvP</button>
        <button onclick="openTab('quests')">Quests</button>
        <button onclick="openTab('codex')">Codex</button>
        <button onclick="openTab('leaderboard')">Leaderboard</button>
      </div>

      <div id="hunt" class="panel active">
        <h2>Hunt</h2>
        <button onclick="hunt()">Hunt Prey</button>
        <p id="huntResult"></p>
        <p id="bloodMoon"></p>
      </div>

      <div id="train" class="panel">
        <h2>Training</h2>
        <button onclick="train()">Train (+Strength)</button>
        <p id="trainResult"></p>
      </div>

      <div id="pvp" class="panel">
        <h2>PvP Arena</h2>
        <button onclick="findOpponent()">Find Opponent</button>
        <div id="pvpResult"></div>
      </div>

      <div id="quests" class="panel">
        <h2>Daily Quests</h2>
        <ul id="questList"></ul>
      </div>

      <div id="codex" class="panel">
        <h2>Codex</h2>
        <div id="codexEntries"></div>
      </div>

      <div id="leaderboard" class="panel">
        <h2>Leaderboard</h2>
        <ol id="leaderboardList"></ol>
      </div>

      <!-- Monetag Ad -->
      <div id="adContainer">
        <h3>üéÅ Watch an Ad to Earn Rewards</h3>
        <button onclick="showRewardAd()">‚ñ∂ Watch Ad</button>
      </div>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="huntSound" src="https://actions.google.com/sounds/v1/animals/wolf_howl.ogg"></audio>
  <audio id="trainSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>
  <audio id="rewardSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBz11XDhnqNwMyNUjqFpoC8lppEgCP-mew",
      authDomain: "eternal-hunt-game-e48fb.firebaseapp.com",
      projectId: "eternal-hunt-game-e48fb",
      storageBucket: "eternal-hunt-game-e48fb.firebasestorage.app",
      messagingSenderId: "87971567607",
      appId: "1:87971567607:web:2b4401b8e8672436ea80f2"
    };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();
  </script>

  <!-- Monetag -->
  <script src="https://alwingulla.com/88/tag.min.js" data-zone="9855091" async></script>

  <script>
    // Game State
    let player={},prey=0,strength=1,level=1,xp=0;
    let huntsToday=0,quests=[],codex=[],codexUnlocked=0;

    const questPools={
      wolf:["Hunt 10 prey","Win 2 PvP battles","Train 3 times","Howl at the moon","Collect a Relic"],
      hunter:["Track 10 wolves","Win 2 PvP duels","Sharpen arrows","Scout the forest","Train 3 times"]
    };
    const codexPools={
      wolf:["The First Howl","Moonlit Hunt","Alpha‚Äôs Oath","Relic of Fangs","The Eternal Hunt","Shadow Stalkers","Wolf Totems","The Silent Howl","Lunar Blessing","Bloodfang Legacy"],
      hunter:["The First Hunt","Silver Arrows","Hunter‚Äôs Creed","Relic of Spears","The Eternal Watch","Shadow Trackers","Hunter Totems","The Silent Step","Lunar Discipline","Bloodmoon Hunt"]
    };

    function saveProfile(){
      const name=document.getElementById("usernameInput").value.trim();
      const role=document.getElementById("roleInput").value;
      if(!name) return alert("Enter a name!");
      player={name,role,prey:0,strength:1,level:1,xp:0,lastDay:""};
      localStorage.setItem("player",JSON.stringify(player));
      db.collection("players").doc(name).set(player);
      document.getElementById("profilePanel").classList.remove("active");
      document.getElementById("gamePanel").classList.add("active");
      loadDaily();
      renderProfile();
    }

    function loadProfile(){
      let stored=localStorage.getItem("player");
      if(stored){ player=JSON.parse(stored);
        document.getElementById("profilePanel").classList.remove("active");
        document.getElementById("gamePanel").classList.add("active");
        loadDaily(); renderProfile();
      }
    }

    function renderProfile(){
      document.getElementById("profileInfo").innerText=
        `${player.name} (${player.role}) | L${player.level} STR${player.strength} | ${player.prey} $PREY | Hunts:${huntsToday}/50`;
    }

    function getDayKey(){ return new Date().toDateString(); }

    function loadDaily(){
      if(player.lastDay!==getDayKey()){
        // Quests
        const pool=questPools[player.role]; quests=[];
        for(let i=0;i<5;i++) quests.push({text:pool[Math.floor(Math.random()*pool.length)],done:false});
        // Codex
        const pool2=codexPools[player.role]; codex=[]; let chosen=[];
        while(codex.length<5){ let e=pool2[Math.floor(Math.random()*pool2.length)]; if(!chosen.includes(e)){ codex.push(e); chosen.push(e);} }
        codexUnlocked=0;
        huntsToday=0; player.lastDay=getDayKey();
        savePlayer();
      }
      renderQuests(); renderCodex();
    }

    function savePlayer(){
      player.prey=prey; player.strength=strength; player.level=level; player.xp=xp;
      localStorage.setItem("player",JSON.stringify(player));
      db.collection("players").doc(player.name).set(player);
    }

    // Tabs
    function openTab(id){
      document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.querySelectorAll(".tab-buttons button").forEach(b=>b.classList.remove("active"));
      document.querySelector(`.tab-buttons button[onclick="openTab('${id}')"]`).classList.add("active");
      if(id==="leaderboard") renderLeaderboard();
    }

    // Hunt
    function isBloodMoon(){ return Math.floor(Date.now()/60000)%4===0; }
    function hunt(){
      if(huntsToday>=50) return alert("Daily hunt limit reached!");
      let gain=Math.floor(Math.random()*10)+1;
      if(isBloodMoon()){ gain*=2; document.getElementById("bloodMoon").innerText="üåë Blood Moon! Double rewards"; }
      else document.getElementById("bloodMoon").innerText="";
      prey+=gain; xp+=10; huntsToday++; checkLevel();
      document.getElementById("huntResult").innerText=`You hunted and gained ${gain} $PREY.`;
      document.getElementById("huntSound").play();
      renderProfile(); savePlayer();
    }

    // Train
    function train(){
      if(prey<20) return alert("Not enough PREY");
      prey-=20; strength++; xp+=5; checkLevel();
      document.getElementById("trainResult").innerText=`You trained. STR=${strength}`;
      document.getElementById("trainSound").play();
      renderProfile(); savePlayer();
    }

    // PvP
    function findOpponent(){
      db.collection("players").get().then(snap=>{
        let opps=[]; snap.forEach(d=>{ if(d.id!==player.name) opps.push(d.data()); });
        if(opps.length===0) return alert("No opponents online");
        let opp=opps[Math.floor(Math.random()*opps.length)];
        let result;
        if(strength>=opp.strength){ prey+=20; xp+=20; result=`You WON vs ${opp.name}`; }
        else result=`You lost vs ${opp.name}`;
        document.getElementById("pvpResult").innerText=result;
        renderProfile(); savePlayer();
      });
    }

    // Quests
    function renderQuests(){
      const ul=document.getElementById("questList"); ul.innerHTML="";
      quests.forEach(q=>{ let li=document.createElement("li"); li.innerText=q.text; if(q.done) li.classList.add("completed"); ul.appendChild(li); });
    }

    // Codex
    function renderCodex(){
      const div=document.getElementById("codexEntries"); div.innerHTML="";
      codex.forEach((c,i)=>{ let p=document.createElement("p"); p.innerText=c;
        if(i<codexUnlocked) p.classList.add("event-active");
        else if(i===codexUnlocked){ p.style.cursor="pointer"; p.onclick=()=>{ codexUnlocked++; prey+=15; xp+=10; alert("üìú Codex unlocked! +15 PREY +10 XP"); document.getElementById("rewardSound").play(); renderCodex(); renderProfile(); savePlayer(); }; }
        else p.style.opacity="0.5";
        div.appendChild(p);
      });
    }

    // Level up
    function checkLevel(){ while(xp>=level*100){ xp-=level*100; level++; } }

    // Leaderboard
    function renderLeaderboard(){
      const ol=document.getElementById("leaderboardList"); ol.innerHTML="";
      db.collection("players").orderBy("prey","desc").limit(10).get().then(snap=>{
        snap.forEach(doc=>{ let li=document.createElement("li"); let d=doc.data(); li.innerText=`${d.name} (${d.role}) - ${d.prey} PREY L${d.level}`; ol.appendChild(li); });
      });
    }

    // Ads
    function showRewardAd(){ alert("Ad playing... (Monetag)"); prey+=50; xp+=25; document.getElementById("rewardSound").play(); alert("üéâ +50 PREY +25 XP"); renderProfile(); savePlayer(); }

    loadProfile();
  </script>
</body>
</html>
