<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eternal Hunt Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin:0; padding:0;
      background:#111; color:#eee;
      text-align:center;
    }
    h1 { color:#ff4444; margin:10px 0; }
    .hidden { display:none; }
    .panel { padding:20px; }
    .btn {
      padding:10px 20px; margin:5px;
      border:none; border-radius:8px;
      background:#333; color:#eee;
      cursor:pointer; transition:0.2s;
    }
    .btn:hover { background:#ff4444; }
    .quest.done { text-decoration:line-through; color:#aaa; }
    .event-active { color:#ff4444; font-weight:bold;
      animation: glow 1s infinite alternate; }
    @keyframes glow {
      from { text-shadow:0 0 5px #f00; }
      to   { text-shadow:0 0 20px #f00; }
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>üê∫ Eternal Hunt</h1>

  <!-- Profile Setup (only once) -->
  <div id="profileSetup" class="panel">
    <h2>Set Up Your Profile</h2>
    <input id="usernameInput" placeholder="Enter Username"/><br><br>
    <select id="roleSelect">
      <option value="wolf">üê∫ Wolf</option>
      <option value="hunter">üèπ Hunter</option>
    </select><br><br>
    <button class="btn" onclick="saveProfile()">Save Profile</button>
  </div>

  <!-- Game UI -->
  <div id="app" class="hidden">
    <div id="profileInfo"></div>
    <p id="bloodMoon"></p>

    <div class="panel">
      <button class="btn" onclick="hunt()">Hunt</button>
      <button class="btn" onclick="train()">Train</button>
      <button class="btn" onclick="pvp()">PvP</button>
    </div>

    <div class="panel">
      <h2>Inventory</h2>
      <ul id="inventoryList"></ul>
      <h3>Shop</h3>
      <button class="btn" onclick="buyItem('Potion',20)">Potion (20 PREY)</button>
      <button class="btn" onclick="buyItem('Relic Shard',100)">Relic Shard (100 PREY)</button>
    </div>

    <div class="panel">
      <h2>Daily Quests</h2>
      <ul id="questList"></ul>
    </div>

    <div class="panel">
      <h2>Daily Codex</h2>
      <div id="codexEntries"></div>
    </div>

    <div class="panel">
      <h2>Leaderboard</h2>
      <ol id="leaderboardList"></ol>
    </div>

    <!-- Monetag Rewarded Ads -->
    <div class="panel">
      <h2>Earn PREY</h2>
      <button class="btn" onclick="showRewardAd()">üé• Watch Ad</button>
      <p id="adResult"></p>
      <script async src="https://acdn.adnxs-simple.com/ast/monetag.js"></script>
      <div id="monetag-ad" data-zone="9855091"></div>
    </div>
  </div>

  <audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="huntSound" src="https://actions.google.com/sounds/v1/animals/wolf_howl.ogg"></audio>

<script>
  // === Daily Codex ===
function loadDaily(){
  const dayKey=getDayKey();
  if(currentUser.lastDay!==dayKey){
    // Reset daily progress
    const pool=[...Array(10)].map((_,i)=>`${currentUser.role==="wolf"?"Wolf Lore":"Hunter Chronicle"} #${i+1}`);
    codex=pool;
    codexUnlocked=0;
    const questPool=questPools[currentUser.role];
    quests=[];
    for(let i=0;i<5;i++){
      quests.push({text:questPool[Math.floor(Math.random()*questPool.length)],done:false});
    }
    huntsToday=0;
    currentUser.lastDay=dayKey;
    savePlayer();
  }
  renderQuests();
  renderCodex();
}

function renderCodex(){
  const div=document.getElementById("codexEntries");
  div.innerHTML="";
  codex.forEach((c,i)=>{
    const p=document.createElement("p");
    p.innerText=c;
    if(i<codexUnlocked){ 
      p.classList.add("event-active"); 
    } else if(i===codexUnlocked){
      p.style.cursor="pointer";
      p.onclick=()=>{
        codexUnlocked++;
        prey+=15; xp+=10;
        alert(`üìú You unlocked a Codex entry and earned 15 PREY + 10 XP!`);
        renderCodex(); renderProfile(); savePlayer();
      };
    } else {
      p.style.opacity="0.5";
    }
    div.appendChild(p);
  });
}
  // === Firebase Setup ===
  const firebaseConfig = {
    apiKey: "AIzaSyBz11XDhnqNwMyNUjqFpoC8lppEgCP-mew",
    authDomain: "eternal-hunt-game-e48fb.firebaseapp.com",
    projectId: "eternal-hunt-game-e48fb",
    storageBucket: "eternal-hunt-game-e48fb.appspot.com",
    messagingSenderId: "87971567607",
    appId: "1:87971567607:web:2b4401b8e8672436ea80f2"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // === Variables ===
  let currentUser=null, inventory=[], quests=[], codex=[];
  let prey=0,strength=1,level=1,xp=0,huntsToday=0,codexUnlocked=0;
  const HUNT_LIMIT=50;

  // === Utility ===
  function playSound(id){ document.getElementById(id).play(); }
  function getDayKey(){ const d=new Date(); return d.toISOString().split("T")[0]; }

  // === Profile Setup ===
  window.onload=async function(){
    const saved=JSON.parse(localStorage.getItem("playerProfile"));
    if(saved){ currentUser=saved; loadProfile(); }
    else { document.getElementById("profileSetup").classList.remove("hidden"); }
  };

  async function saveProfile(){
    const username=document.getElementById("usernameInput").value.trim();
    const role=document.getElementById("roleSelect").value;
    if(!username) return alert("Enter a username!");
    currentUser={username,role,prey:0,strength:1,level:1,xp:0,lastDay:""};
    await db.collection("players").doc(username).set(currentUser);
    localStorage.setItem("playerProfile",JSON.stringify(currentUser));
    loadProfile();
  }

  function loadProfile(){
    document.getElementById("profileSetup").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    renderProfile();
    loadDaily();
    loadLeaderboard();
  }

  function renderProfile(){
    document.getElementById("profileInfo").innerText=
      `${currentUser.username} | Role: ${currentUser.role} | PREY:${prey} | Lvl:${level}`;
  }

  // === Daily Quests & Codex ===
  const questPools={
    wolf:[
      "Hunt 5 prey","Train twice","Defeat a Hunter in PvP","Unlock 3 Codex entries",
      "Collect a Relic Shard","Survive 3 Blood Moon hunts","Buy item from shop",
      "Win 2 hunts","Gather 100 PREY","Howl with pack"
    ],
    hunter:[
      "Hunt 5 beasts","Train twice","Defeat a Wolf in PvP","Unlock 3 Codex entries",
      "Obtain Wolf Totem","Survive 3 Blood Moon hunts","Buy item from shop",
      "Win 2 PvP battles","Gather 100 PREY","Scout the woods"
    ]
  };

  function loadDaily(){
    const dayKey=getDayKey();
    if(currentUser.lastDay!==dayKey){
      const pool=questPools[currentUser.role];
      quests=[];
      for(let i=0;i<5;i++){
        const q=pool[Math.floor(Math.random()*pool.length)];
        quests.push({text:q,done:false});
      }
      codex=[...Array(5)].map((_,i)=>`${currentUser.role==="wolf"?"Wolf Lore":"Hunter Chronicle"} #${i+1}`);
      currentUser.lastDay=dayKey;
      localStorage.setItem("playerProfile",JSON.stringify(currentUser));
    }
    renderQuests();
    renderCodex();
  }

  function renderQuests(){
    const list=document.getElementById("questList"); list.innerHTML="";
    quests.forEach((q,i)=>{
      const li=document.createElement("li");
      li.innerText=q.text;
      if(q.done) li.classList.add("quest","done");
      li.onclick=()=>{ q.done=true; prey+=25; xp+=20; renderQuests(); renderProfile(); savePlayer(); };
      list.appendChild(li);
    });
  }

  function renderCodex(){
    const div=document.getElementById("codexEntries"); div.innerHTML="";
    codex.forEach((c,i)=>{
      const p=document.createElement("p");
      p.innerText=c;
      p.onclick=()=>{ if(i===codexUnlocked){ codexUnlocked++; p.classList.add("event-active"); } };
      div.appendChild(p);
    });
  }

  // === Game Actions ===
  function isBloodMoon(){ return Math.floor(Date.now()/60000)%4===0; }

  function hunt(){
    if(huntsToday>=HUNT_LIMIT) return alert("Daily hunt limit reached!");
    playSound("huntSound");
    let gained=Math.floor(Math.random()*10)+1;
    if(isBloodMoon()){ gained*=2; document.getElementById("bloodMoon").innerText="üåë Blood Moon! Double rewards!"; }
    else document.getElementById("bloodMoon").innerText="";
    prey+=gained; xp+=10; huntsToday++;
    renderProfile(); savePlayer();
  }

  function train(){ if(prey>=20){ prey-=20; strength++; xp+=5; renderProfile(); savePlayer(); } }

  async function pvp(){
    const snap=await db.collection("players").get();
    const others=snap.docs.map(d=>d.data()).filter(p=>p.username!==currentUser.username);
    if(others.length===0) return alert("No opponents!");
    const enemy=others[Math.floor(Math.random()*others.length)];
    const result=(strength>=enemy.strength)?"You won!":"You lost!";
    if(result==="You won!"){ prey+=15; xp+=10; }
    alert(`${result} vs ${enemy.username} (STR ${enemy.strength})`);
    renderProfile(); savePlayer();
  }

  function buyItem(item,cost){
    if(prey>=cost){ prey-=cost; inventory.push(item); renderInventory(); renderProfile(); savePlayer(); }
  }

  function renderInventory(){
    const list=document.getElementById("inventoryList"); list.innerHTML="";
    inventory.forEach(i=>{ const li=document.createElement("li"); li.innerText=i; list.appendChild(li); });
  }

  // === Leaderboard ===
  async function loadLeaderboard(){
    const snap=await db.collection("players").orderBy("prey","desc").limit(10).get();
    const list=document.getElementById("leaderboardList"); list.innerHTML="";
    snap.forEach(doc=>{
      const p=doc.data();
      const li=document.createElement("li");
      li.innerText=`${p.username}: ${p.prey} PREY (Lvl ${p.level} STR ${p.strength})`;
      list.appendChild(li);
    });
  }

  async function savePlayer(){
    currentUser.prey=prey; currentUser.strength=strength; currentUser.level=level; currentUser.xp=xp;
    await db.collection("players").doc(currentUser.username).set(currentUser);
    localStorage.setItem("playerProfile",JSON.stringify(currentUser));
    loadLeaderboard();
  }

  // === Ads ===
  function showRewardAd(){
    // Placeholder reward
    prey+=10; document.getElementById("adResult").innerText="You earned 10 PREY!";
    renderProfile(); savePlayer();
  }
</script>
</body>
</html>
