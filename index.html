<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üê∫ Eternal Hunt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin:0; padding:0; font-family:sans-serif;
      background:#111; color:#eee; text-align:center;
    }
    h1 { color:#ff4444; margin:10px 0; }
    .hidden { display:none; }
    .panel {
      background:#222; margin:15px; padding:20px;
      border-radius:12px; box-shadow:0 0 8px #000;
    }
    button {
      background:#ff4444; border:none; color:#fff;
      padding:10px 16px; margin:5px; border-radius:8px;
      cursor:pointer; font-weight:bold;
      transition:transform .2s;
    }
    button:hover { transform:scale(1.05); }
    input, select {
      padding:8px; border-radius:6px; border:none;
      margin:5px 0; width:80%;
    }
    .glow { animation:glow 1s infinite alternate; }
    @keyframes glow {
      from { text-shadow:0 0 5px #f00; }
      to { text-shadow:0 0 20px #f00; }
    }
  </style>
</head>
<body>
  <h1>üê∫ Eternal Hunt</h1>

  <!-- Profile Setup -->
  <div id="profileSetup" class="panel hidden">
    <h2>Set Up Your Profile</h2>
    <input id="usernameInput" placeholder="Enter Username">
    <br>
    <select id="roleSelect">
      <option value="wolf">üê∫ Wolf</option>
      <option value="hunter">üèπ Hunter</option>
    </select>
    <br>
    <button onclick="saveProfile()">Save Profile</button>
  </div>

  <!-- Main Game -->
  <div id="app" class="hidden">
    <div id="profileInfo" class="panel"></div>

    <div class="panel">
      <button onclick="hunt()">Hunt</button>
      <button onclick="train()">Train</button>
      <button onclick="pvp()">PvP</button>
      <p id="huntResult"></p>
      <p id="bloodMoon" class="glow"></p>
    </div>

    <div class="panel">
      <h3>Inventory</h3>
      <ul id="inventoryList"></ul>
    </div>

    <div class="panel">
      <h3>Shop</h3>
      <button onclick="buyItem('Wolf Totem',200)">Wolf Totem (200 PREY)</button>
      <button onclick="buyItem('Relic Shard',100)">Relic Shard (100 PREY)</button>
      <p id="shopResult"></p>
    </div>

    <div class="panel">
      <h3>Daily Quests</h3>
      <ul id="questList"></ul>
    </div>

    <div class="panel">
      <h3>Codex</h3>
      <div id="codexEntries"></div>
    </div>

    <div class="panel">
      <h3>Leaderboard</h3>
      <ol id="leaderboardList"></ol>
    </div>

    <div class="panel">
      <h3>üé• Watch Ad for Reward</h3>
      <button onclick="showRewardedAd()">Watch Ad</button>
      <p id="adStatus"></p>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="huntSound" src="https://actions.google.com/sounds/v1/animals/wolf_howl.ogg"></audio>
  <audio id="trainSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="pvpSound" src="https://actions.google.com/sounds/v1/human_voices/female_grunt.ogg"></audio>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBz11XDhnqNwMyNUjqFpoC8lppEgCP-mew",
      authDomain: "eternal-hunt-game-e48fb.firebaseapp.com",
      projectId: "eternal-hunt-game-e48fb",
      storageBucket: "eternal-hunt-game-e48fb.appspot.com",
      messagingSenderId: "87971567607",
      appId: "1:87971567607:web:2b4401b8e8672436ea80f2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser=null, prey=0, strength=1, level=1, xp=0;
    let dailyHunts=0, dailyLimit=50, inventory=[];
    let quests=[], codex=[];

    // On load check profile
    window.onload=async()=>{
      const saved=JSON.parse(localStorage.getItem("playerProfile"));
      if(saved){
        currentUser=saved; prey=saved.prey; strength=saved.strength;
        level=saved.level; xp=saved.xp;
        document.getElementById("profileSetup").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        renderProfile(); loadDaily(); loadLeaderboard();
      } else {
        document.getElementById("profileSetup").classList.remove("hidden");
      }
    };

    async function saveProfile(){
      const username=document.getElementById("usernameInput").value.trim();
      const role=document.getElementById("roleSelect").value;
      if(!username) return alert("Enter username");

      const profile={username,role,prey:0,strength:1,level:1,xp:0,createdAt:new Date().toISOString()};
      await db.collection("players").doc(username).set(profile);
      localStorage.setItem("playerProfile",JSON.stringify(profile));
      currentUser=profile; prey=0; strength=1; level=1; xp=0;
      document.getElementById("profileSetup").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
      renderProfile(); loadDaily(); loadLeaderboard();
    }

    function renderProfile(){
      document.getElementById("profileInfo").innerText=
        `${currentUser.username} | ${currentUser.role} | PREY:${prey} | Lvl:${level} STR:${strength}`;
    }

    // Hunt with daily limit + blood moon
    function hunt(){
      if(dailyHunts>=dailyLimit){ alert("Daily Hunt limit reached!"); return; }
      let gained=Math.floor(Math.random()*10)+5;
      if(isBloodMoon()){ gained*=2; document.getElementById("bloodMoon").innerText="üåë Blood Moon! Double PREY"; }
      else { document.getElementById("bloodMoon").innerText=""; }
      prey+=gained; xp+=10; dailyHunts++;
      document.getElementById("huntResult").innerText=`You gained ${gained} PREY. Total: ${prey}`;
      document.getElementById("huntSound").play();
      checkLevelUp(); updateDB();
    }

    function train(){
      if(prey>=20){ prey-=20; strength++; xp+=5;
        document.getElementById("trainSound").play();
        document.getElementById("huntResult").innerText=`You trained. STR=${strength}`;
        checkLevelUp(); updateDB();
      } else alert("Not enough PREY");
    }

    async function pvp(){
      const snap=await db.collection("players").get();
      const others=snap.docs.map(d=>d.data()).filter(p=>p.username!==currentUser.username);
      if(!others.length){ alert("No other players online!"); return; }
      const enemy=others[Math.floor(Math.random()*others.length)];
      let result;
      if(strength>=enemy.strength){ prey+=15; result=`You beat ${enemy.username}! +15 PREY`; }
      else result=`${enemy.username} defeated you.`;
      document.getElementById("pvpSound").play();
      document.getElementById("huntResult").innerText=result;
      updateDB();
    }

    function checkLevelUp(){ while(xp>=level*100){ xp-=level*100; level++; } renderProfile(); }

    function buyItem(item,cost){
      if(prey>=cost){ prey-=cost; inventory.push(item);
        document.getElementById("shopResult").innerText=`Bought ${item}`;
        updateDB(); renderInventory();
      } else alert("Not enough PREY");
    }

    function renderInventory(){
      const ul=document.getElementById("inventoryList"); ul.innerHTML="";
      inventory.forEach(i=>{ let li=document.createElement("li"); li.innerText=i; ul.appendChild(li); });
    }

    function isBloodMoon(){ return (new Date().getMinutes()%4===0); }

    function loadDaily(){
      // Daily quests and codex reset
      quests=[...Array(10)].map((_,i)=>({text:`${currentUser.role} Quest ${i+1}`,done:false}));
      codex=[...Array(10)].map((_,i)=>`Codex entry ${i+1} of the day`);
      renderQuests(); renderCodex();
    }

    function renderQuests(){
      const ul=document.getElementById("questList"); ul.innerHTML="";
      quests.forEach(q=>{ let li=document.createElement("li"); li.innerText=q.text+(q.done?" ‚úÖ":""); ul.appendChild(li); });
    }
    function renderCodex(){
      const div=document.getElementById("codexEntries"); div.innerHTML="";
      codex.forEach(c=>{ let p=document.createElement("p"); p.innerText=c; div.appendChild(p); });
    }

    async function loadLeaderboard(){
      const snap=await db.collection("players").orderBy("prey","desc").limit(10).get();
      const list=document.getElementById("leaderboardList"); list.innerHTML="";
      snap.forEach(doc=>{
        const p=doc.data();
        let li=document.createElement("li");
        li.innerText=`${p.username} (${p.role}) PREY:${p.prey} Lvl:${p.level}`;
        list.appendChild(li);
      });
    }

    async function updateDB(){
      if(currentUser){
        Object.assign(currentUser,{prey,strength,level,xp});
        await db.collection("players").doc(currentUser.username).set(currentUser);
        localStorage.setItem("playerProfile",JSON.stringify(currentUser));
        renderProfile(); loadLeaderboard();
      }
    }

    // Monetag Ads placeholder
    function showRewardedAd(){
      document.getElementById("adStatus").innerText="üé• Playing ad...";
      setTimeout(()=>{
        prey+=20; updateDB();
        document.getElementById("adStatus").innerText="‚úÖ Ad watched, +20 PREY!";
      },4000);
    }
  </script>
</body>
</html>
