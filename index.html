<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🐺 Eternal Hunt</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#111; color:#eee; }
    h1 { text-align:center; color:#ff4444; margin:10px; }
    .container { display:grid; grid-template-columns:1fr 1fr; gap:16px; padding:10px; }
    .card { background:#222; border-radius:12px; padding:12px; box-shadow:0 0 10px rgba(0,0,0,0.6); }
    button { background:#333; color:#eee; border:none; padding:6px 10px; margin:3px; border-radius:6px; cursor:pointer; }
    button:hover { background:#ff4444; }
    .quest.completed { text-decoration: line-through; color:#888; }
    .glow { animation:glow 1s infinite alternate; }
    @keyframes glow { from{ text-shadow:0 0 5px #f00; } to{ text-shadow:0 0 15px #f00; } }
    .small { font-size:0.9em; }
  </style>
</head>
<body>
  <h1>🐺 Eternal Hunt</h1>
  <div class="container">
    <!-- Left column -->
    <div>
      <div class="card" id="profileCard">
        <div><b>Discord:</b> <span id="usernameDisplay"></span></div>
        <div><b>Role:</b> <span id="roleDisplay"></span></div>
        <div><b>Level:</b> <span id="levelDisplay">1</span></div>
        <div><b>Strength:</b> <span id="strengthDisplay">1</span></div>
        <div><b>$PREY:</b> <span id="preyDisplay">0</span></div>
      </div>
      <div class="card">
        <button onclick="hunt()">🦌 Hunt</button>
        <button onclick="train()">💪 Train</button>
        <button onclick="pvp()">⚔️ PvP</button>
        <p id="actionResult"></p>
        <p id="bloodMoon"></p>
      </div>
      <div class="card">
        <h3>🎒 Inventory</h3>
        <ul id="inventoryList"></ul>
      </div>
      <div class="card">
        <h3>🎯 Quests</h3>
        <ul id="questList"></ul>
      </div>
      <div class="card">
        <h3>📖 Codex</h3>
        <div id="codexEntries"></div>
      </div>
      <!-- ✅ Relic Shop -->
      <div class="card">
        <h3>🛡 Relic Shop</h3>
        <div class="small">
          <div>Alpha Fang (Wolf Relic) — 100 $PREY <button onclick="buyItem('Alpha Fang',100)">Buy</button></div>
          <div>Hunter’s Bow (Hunter Relic) — 100 $PREY <button onclick="buyItem('Hunter’s Bow',100)">Buy</button></div>
          <div>Moon Totem — 150 $PREY <button onclick="buyItem('Moon Totem',150)">Buy</button></div>
          <div>Cloak of Shadows — 150 $PREY <button onclick="buyItem('Cloak of Shadows',150)">Buy</button></div>
        </div>
        <p id="shopResult"></p>
      </div>
      <div class="card">
        <h3>🎁 Daily & Rewards</h3>
        <button onclick="claimDaily()">Claim Daily Reward</button>
        <button onclick="watchAd()">Watch Ad for $PREY</button>
        <p id="rewardResult"></p>
      </div>
    </div>
    <!-- Right column -->
    <div>
      <div class="card">
        <h3>🏆 Global Leaderboard</h3>
        <ol id="leaderboardList"></ol>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // 🔥 Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCo5-2sXN4S9Vatc39KvvGFgz_T0bk57Gg",
      authDomain: "eternal-hunt-game.firebaseapp.com",
      projectId: "eternal-hunt-game",
      storageBucket: "eternal-hunt-game.appspot.com",
      messagingSenderId: "374543567150",
      appId: "1:374543567150:web:56711f82f75c8376e312bf"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ===== Game state =====
    let username = localStorage.getItem('username') || prompt("Enter your Discord username:");
    localStorage.setItem('username', username);
    let role = localStorage.getItem('role') || prompt("Choose your role: Wolf or Hunter");
    localStorage.setItem('role', role);

    let prey = 0, strength = 1, level = 1, xp = 0;
    let inventory = [];
    let quests = [];
    let codex = [];

    document.getElementById('usernameDisplay').textContent = username;
    document.getElementById('roleDisplay').textContent = role;

    // Role-based quests
    if(role.toLowerCase()==="wolf"){
      quests = [
        {text:"Hunt 5 prey", goal:5, progress:0, reward:50, completed:false},
        {text:"Win 3 PvP battles", goal:3, progress:0, reward:"Alpha Fang", completed:false},
        {text:"Train 5 times", goal:5, progress:0, reward:40, completed:false},
        {text:"Defeat a Hunter", goal:1, progress:0, reward:"Moon Totem", completed:false},
        {text:"Accumulate 200 $PREY", goal:200, progress:0, reward:"Cloak of Shadows", completed:false},
        {text:"Reach Level 5", goal:5, progress:0, reward:100, completed:false},
        {text:"Own 2 relics", goal:2, progress:0, reward:"Wolf Totem", completed:false},
        {text:"Complete 3 quests", goal:3, progress:0, reward:80, completed:false},
        {text:"Survive 3 PvP losses", goal:3, progress:0, reward:30, completed:false},
        {text:"Train strength to 10", goal:10, progress:0, reward:"Wolf Banner", completed:false}
      ];
      codex = [
        {level:1,text:"The Pack awakens under the Blood Moon."},
        {level:5,text:"Wolves claim the first relics of power."},
        {level:10,text:"Alpha spirits whisper through the hunt."}
      ];
    } else {
      quests = [
        {text:"Hunt 3 prey", goal:3, progress:0, reward:40, completed:false},
        {text:"Win 3 PvP battles", goal:3, progress:0, reward:"Hunter’s Bow", completed:false},
        {text:"Train 5 times", goal:5, progress:0, reward:40, completed:false},
        {text:"Defeat a Wolf", goal:1, progress:0, reward:"Cloak of Shadows", completed:false},
        {text:"Accumulate 200 $PREY", goal:200, progress:0, reward:"Hunter’s Emblem", completed:false},
        {text:"Reach Level 5", goal:5, progress:0, reward:100, completed:false},
        {text:"Own 2 relics", goal:2, progress:0, reward:"Moon Totem", completed:false},
        {text:"Complete 3 quests", goal:3, progress:0, reward:80, completed:false},
        {text:"Survive 3 PvP losses", goal:3, progress:0, reward:30, completed:false},
        {text:"Train strength to 10", goal:10, progress:0, reward:"Hunter’s Cloak", completed:false}
      ];
      codex = [
        {level:1,text:"The Hunters swear oaths beneath starlight."},
        {level:5,text:"Relics of ancient order resurface."},
        {level:10,text:"The Hunt converges under crimson skies."}
      ];
    }

    // ===== Core functions =====
    function updateUI(){
      document.getElementById('preyDisplay').textContent = prey;
      document.getElementById('strengthDisplay').textContent = strength;
      document.getElementById('levelDisplay').textContent = level;
      renderInventory(); renderQuests(); renderCodex();
    }

    function isBloodMoon(){ return (Math.floor(Date.now()/60000)%4===0); }

    function hunt(){
      let gained = Math.floor(Math.random()*10)+1;
      if(isBloodMoon()){ gained*=2; document.getElementById('bloodMoon').textContent="🌑 Blood Moon active!"; }
      else document.getElementById('bloodMoon').textContent="";
      prey+=gained; xp+=10; checkLevelUp();
      document.getElementById('actionResult').textContent=`You hunted and gained ${gained} $PREY.`;
      updateQuests("hunt"); savePlayer(); updateUI();
    }

    function train(){
      if(prey>=20){ prey-=20; strength++; xp+=5; checkLevelUp(); document.getElementById('actionResult').textContent="You trained."; }
      else document.getElementById('actionResult').textContent="Not enough $PREY.";
      updateQuests("train"); savePlayer(); updateUI();
    }

    function pvp(){
      let enemyStr=Math.floor(Math.random()*5)+1;
      if(strength>=enemyStr){ document.getElementById('actionResult').textContent="You won PvP!"; prey+=15; updateQuests("pvp"); }
      else { document.getElementById('actionResult').textContent="You lost PvP."; }
      savePlayer(); updateUI();
    }

    function buyItem(item,cost){
      if(prey>=cost){ prey-=cost; inventory.push(item); document.getElementById('shopResult').textContent=`Bought ${item}`; }
      else document.getElementById('shopResult').textContent="Not enough $PREY.";
      updateQuests("relic"); savePlayer(); updateUI();
    }

    function claimDaily(){ prey+=30; document.getElementById('rewardResult').textContent="Daily +30 $PREY"; savePlayer(); updateUI(); }
    function watchAd(){ prey+=20; document.getElementById('rewardResult').textContent="Ad watched: +20 $PREY"; savePlayer(); updateUI(); }

    function checkLevelUp(){ while(xp>=level*100){ xp-=level*100; level++; } }

    function renderInventory(){
      const list=document.getElementById('inventoryList'); list.innerHTML=""; inventory.forEach(i=>{let li=document.createElement('li'); li.textContent=i; list.appendChild(li);});
    }
    function renderQuests(){
      const list=document.getElementById('questList'); list.innerHTML="";
      quests.forEach(q=>{let li=document.createElement('li'); li.textContent=`${q.text} [${q.progress}/${q.goal}]`; if(q.completed) li.classList.add('quest','completed'); list.appendChild(li);});
    }
    function renderCodex(){
      const div=document.getElementById('codexEntries'); div.innerHTML=""; codex.forEach(c=>{ if(level>=c.level){let p=document.createElement('p'); p.textContent=c.text; p.classList.add('glow'); div.appendChild(p);} });
    }

    function updateQuests(type){
      quests.forEach(q=>{
        if(!q.completed){
          if(type==="hunt" && q.text.includes("Hunt")) q.progress++;
          if(type==="train" && q.text.includes("Train")) q.progress++;
          if(type==="pvp" && q.text.includes("PvP")) q.progress++;
          if(type==="relic" && q.text.includes("relics")) q.progress=inventory.length;
          if(q.text.includes("Level") && level>=q.goal) q.progress=q.goal;
          if(q.text.includes("strength") && strength>=q.goal) q.progress=q.goal;
          if(q.text.includes("Accumulate") && prey>=q.goal) q.progress=q.goal;
          if(q.progress>=q.goal){ q.completed=true; if(typeof q.reward==="number") prey+=q.reward; else inventory.push(q.reward); }
        }
      });
      renderQuests();
    }

    // ===== Firebase Save/Load =====
    async function savePlayer(){
      const ref = doc(db,"players",username);
      await setDoc(ref,{ username, role, prey, strength, level, inventory },{merge:true});
      loadLeaderboard();
    }
    async function loadLeaderboard(){
      const snap=await getDocs(collection(db,"players"));
      const list=document.getElementById('leaderboardList'); list.innerHTML="";
      let players=[]; snap.forEach(doc=>players.push(doc.data()));
      players.sort((a,b)=>b.prey-a.prey);
      players.slice(0,10).forEach(p=>{ let li=document.createElement('li'); li.textContent=`${p.username} (${p.role}) — ${p.prey} $PREY L${p.level} STR${p.strength}`; list.appendChild(li); });
    }

    updateUI(); savePlayer(); loadLeaderboard();
  </script>
</body>
</html>
